<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN" "http://www.w3.org/Math/DTD/mathml2/xhtml-math11-f.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><!--This file was converted to xhtml by LibreOffice - see http://cgit.freedesktop.org/libreoffice/core/tree/filter/source/xslt for the code.--><head profile="http://dublincore.org/documents/dcmi-terms/"><meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8"/><title xml:lang="en-US">- no title specified</title><meta name="DCTERMS.title" content="" xml:lang="en-US"/><meta name="DCTERMS.language" content="en-US" scheme="DCTERMS.RFC4646"/><meta name="DCTERMS.source" content="http://xml.openoffice.org/odf2xhtml"/><meta name="DCTERMS.issued" content="2016-07-05T13:36:27.552000000" scheme="DCTERMS.W3CDTF"/><meta name="DCTERMS.modified" content="2017-05-18T13:01:19.771000000" scheme="DCTERMS.W3CDTF"/><meta name="DCTERMS.provenance" content="" xml:lang="en-US"/><meta name="DCTERMS.subject" content="," xml:lang="en-US"/><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" hreflang="en"/><link rel="schema.DCTERMS" href="http://purl.org/dc/terms/" hreflang="en"/><link rel="schema.DCTYPE" href="http://purl.org/dc/dcmitype/" hreflang="en"/><link rel="schema.DCAM" href="http://purl.org/dc/dcam/" hreflang="en"/><style type="text/css">
	@page {  }
	table { border-collapse:collapse; border-spacing:0; empty-cells:show }
	td, th { vertical-align:top; font-size:12pt;}
	h1, h2, h3, h4, h5, h6 { clear:both }
	ol, ul { margin:0; padding:0;}
	li { list-style: none; margin:0; padding:0;}
	<!-- "li span.odfLiEnd" - IE 7 issue-->
	li span. { clear: both; line-height:0; width:0; height:0; margin:0; padding:0; }
	span.footnodeNumber { padding-right:1em; }
	span.annotation_style_by_filter { font-size:95%; font-family:Arial; background-color:#fff000;  margin:0; border:0; padding:0;  }
	* { margin:0;}
	.Contents_20_1 { font-size:12pt; font-family:Liberation Serif; writing-mode:lr-tb; margin-left:0cm; margin-right:0cm; text-indent:0cm; }
	.Contents_20_2 { font-size:12pt; font-family:Liberation Serif; writing-mode:lr-tb; margin-left:0.499cm; margin-right:0cm; text-indent:0cm; }
	.Contents_20_3 { font-size:12pt; font-family:Liberation Serif; writing-mode:lr-tb; margin-left:0.998cm; margin-right:0cm; text-indent:0cm; }
	.Contents_20_4 { font-size:12pt; font-family:Liberation Serif; writing-mode:lr-tb; margin-left:1.498cm; margin-right:0cm; text-indent:0cm; }
	.Contents_20_Heading { color:#0066cc; font-size:16pt; margin-bottom:0.212cm; margin-top:0.423cm; font-family:Liberation Sans; writing-mode:lr-tb; margin-left:0cm; margin-right:0cm; text-indent:0cm; font-weight:bold; }
	.Heading_20_1 { color:#0066cc; font-size:130%; margin-bottom:0.212cm; margin-top:0.423cm; font-family:Liberation Sans; writing-mode:lr-tb; margin-left:0cm; margin-right:0cm; text-indent:0cm; font-style:italic; text-decoration:underline; font-weight:normal; }
	.Heading_20_4 { color:#000000; font-size:95%; margin-bottom:0.212cm; margin-top:0.212cm; font-family:Liberation Sans; writing-mode:lr-tb; margin-left:0cm; margin-right:0cm; text-indent:0cm; font-style:italic; font-weight:bold; }
	.P1 { font-size:12pt; line-height:120%; margin-bottom:0.247cm; margin-top:0cm; font-family:Liberation Serif; writing-mode:lr-tb; }
	.P10 { font-size:12pt; font-family:Liberation Serif; writing-mode:lr-tb; }
	.P11 { font-size:12pt; font-family:Liberation Serif; writing-mode:lr-tb; }
	.P12 { font-size:12pt; margin-left:1.498cm; margin-right:0cm; text-indent:0cm; font-family:Liberation Serif; writing-mode:lr-tb; }
	.P13 { font-size:12pt; margin-left:0cm; margin-right:0cm; text-indent:0cm; font-family:Liberation Serif; writing-mode:lr-tb; }
	.P14 { color:#0066cc; font-size:130%; font-style:italic; font-weight:normal; margin-bottom:0.212cm; margin-left:0cm; margin-right:0cm; margin-top:0.423cm; text-indent:0cm; font-family:Liberation Sans; text-decoration:underline; writing-mode:lr-tb; }
	.P15 { color:#0066cc; font-size:130%; font-style:italic; font-weight:normal; margin-bottom:0.212cm; margin-left:0cm; margin-right:0cm; margin-top:0.423cm; text-indent:0cm; font-family:Liberation Sans; text-decoration:underline; writing-mode:lr-tb; }
	.P2 { font-size:12pt; line-height:120%; margin-bottom:0.247cm; margin-top:0cm; font-family:Liberation Serif; writing-mode:lr-tb; }
	.P3 { font-size:12pt; line-height:120%; margin-bottom:0.247cm; margin-top:0cm; font-family:Liberation Serif; writing-mode:lr-tb; }
	.P4 { font-size:12pt; line-height:120%; margin-bottom:0.247cm; margin-top:0cm; font-family:Liberation Serif; writing-mode:lr-tb; }
	.P5 { font-size:12pt; line-height:120%; margin-bottom:0.247cm; margin-top:0cm; font-family:Liberation Serif; writing-mode:lr-tb; }
	.P6 { font-size:12pt; line-height:120%; margin-bottom:0.247cm; margin-top:0cm; font-family:Liberation Serif; writing-mode:lr-tb; }
	.P7 { font-size:12pt; line-height:120%; margin-bottom:0.247cm; margin-top:0cm; font-family:Liberation Serif; writing-mode:lr-tb; }
	.P8 { font-size:12pt; line-height:120%; margin-bottom:0.247cm; margin-top:0cm; font-family:Liberation Serif; writing-mode:lr-tb; }
	.P9 { font-size:12pt; line-height:120%; margin-bottom:0.247cm; margin-top:0cm; font-family:Liberation Serif; writing-mode:lr-tb; }
	.Text_20_body { font-size:12pt; font-family:Liberation Serif; writing-mode:lr-tb; margin-top:0cm; margin-bottom:0.247cm; line-height:120%; }
	.Table1 { width:17.013cm; margin-left:0cm; margin-right:auto;}
	.Table1_A1 { padding:0.097cm; border-left-width:thin; border-left-style:solid; border-left-color:#000000; border-right-style:none; border-top-width:thin; border-top-style:solid; border-top-color:#000000; border-bottom-width:thin; border-bottom-style:solid; border-bottom-color:#000000; }
	.Table1_A2 { padding:0.097cm; border-left-width:thin; border-left-style:solid; border-left-color:#000000; border-right-style:none; border-top-style:none; border-bottom-width:thin; border-bottom-style:solid; border-bottom-color:#000000; }
	.Table1_B1 { padding:0.097cm; border-width:thin; border-style:solid; border-color:#000000; }
	.Table1_B2 { padding:0.097cm; border-left-width:thin; border-left-style:solid; border-left-color:#000000; border-right-width:thin; border-right-style:solid; border-right-color:#000000; border-top-style:none; border-bottom-width:thin; border-bottom-style:solid; border-bottom-color:#000000; }
	.Table1_A { width:3.413cm; }
	.Table1_B { width:13.6cm; }
	.Internet_20_link { color:#000080; text-decoration:underline; }
	.T3 { color:#000000; font-family:Verdana; font-size:8pt; }
	.T4 { color:#000000; font-family:Liberation Serif; font-size:12pt; }
	<!-- ODF styles with no properties representable as CSS -->
	.Sect1 .Index_20_Link .T1 .T2  { }
	</style></head><body dir="ltr" style="max-width:21.001cm;margin-top:2cm; margin-bottom:2cm; margin-left:2cm; margin-right:2cm; "><h1 class="P14"><a id="a__Simple_python_script___Bitbucket_to_discord_commit_messages"><span/></a><a id="__RefHeading___Toc909_303725736"/>Simple python script – Bitbucket to discord commit messages</h1><p class="P4"> </p><p class="P5">This is a simple script that checks for push changes to a bit bucket repository. Once found all commit messages are then posted to a discord channel.</p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"/><p class="P1"> </p><p class="P1"> </p><table border="0" cellspacing="0" cellpadding="0" class="Sect1"><colgroup/><p class="Contents_20_Heading">Table of Contents</p><tr><td><p class="P13"><a href="#__RefHeading___Toc909_303725736">Simple python script – Bitbucket to discord commit messages</a></p></td></tr><tr><td><p class="P13"><a href="#__RefHeading___Toc358_1493417463">Versions and requirements</a></p></td></tr><tr><td><p class="P13"><a href="#__RefHeading___Toc131_1748241689">Files</a></p></td></tr><tr><td><p class="P13"><a href="#__RefHeading___Toc360_1493417463">Making changes</a></p></td></tr><tr><td><p class="P13"><a href="#__RefHeading___Toc135_1748241689">How to construct bitbucket url</a></p></td></tr><tr><td><p class="P13"><a href="#__RefHeading___Toc137_1748241689">User name and paswords</a></p></td></tr><tr><td><p class="P13"><a href="#__RefHeading___Toc141_1748241689">Changes that the script makes to the url</a></p></td></tr><tr><td><p class="P13"><a href="#__RefHeading___Toc143_1748241689">JSON sample</a></p></td></tr><tr><td><p class="P13"><a href="#__RefHeading___Toc362_1493417463">Notes on getting more commit messages</a></p></td></tr><tr><td><p class="P12"><a href="#__RefHeading___Toc364_1493417463">My issues with cron</a></p></td></tr><tr><td><p class="P12"><a href="#__RefHeading___Toc366_1493417463">Bit Bucket things</a></p></td></tr><tr><td><p class="P12"><a href="#__RefHeading___Toc368_1493417463">Thanks</a></p></td></tr></table><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P1"> </p><p class="P3"> </p><p class="Text_20_body"> </p><p class="P2"> </p><p class="P2"> </p><p class="P2"> </p><p class="P2"> </p><p class="P2"> </p><p class="P2"> </p><p class="P2"> </p><p class="P2"> </p><p class="P2"> </p><p class="P2"> </p><p class="P2"> </p><p class="P2"> </p><h1 class="P15"><a id="a__Versions_and_requirements"><span/></a><a id="__RefHeading___Toc358_1493417463"/>Versions and requirements</h1><p class="P5">Python 3.6</p><p class="P5">- Requests</p><p class="P5"> </p><p class="P5">Bitbucket account with access to the repository (I have not checked if this works on public repository’s)</p><p class="P5">Discord server, You have access to a webhook link</p><p class="P5">(see below for obtaining links)</p><h1 class="Heading_20_1"><a id="a__Files"><span/></a><a id="__RefHeading___Toc131_1748241689"/>Files</h1><table border="0" cellspacing="0" cellpadding="0" class="Table1"><colgroup><col width="149"/><col width="594"/></colgroup><tr><td style="text-align:left;width:3.413cm; " class="Table1_A1"><p class="P10">File</p></td><td style="text-align:left;width:13.6cm; " class="Table1_B1"><p class="P10">Description</p></td></tr><tr><td style="text-align:left;width:3.413cm; " class="Table1_A2"><p class="P10">BucketMonitor.py</p></td><td style="text-align:left;width:13.6cm; " class="Table1_B2"><p class="P10">Run this script to start</p></td></tr><tr><td style="text-align:left;width:3.413cm; " class="Table1_A2"><p class="P10">BitGet.py</p></td><td style="text-align:left;width:13.6cm; " class="Table1_B2"><p class="P10">Makes the requests to bit bucket, and processes the data (slightly), uses username and passwords</p></td></tr><tr><td style="text-align:left;width:3.413cm; " class="Table1_A2"><p class="P10">DisPost.py</p></td><td style="text-align:left;width:13.6cm; " class="Table1_B2"><p class="P10">Posts the actual message to discord. Should you wish to alter the content of the message you will need to alter the send message function.<br/><br/><span class="T1">The discord URL is taken and ‘/slack’ is automatically appended to the end so the post can be made (don’t add it yourself).<br/><br/>For more info on the JSON see below.</span></p></td></tr><tr><td style="text-align:left;width:3.413cm; " class="Table1_A2"><p class="P11">LastNode</p></td><td style="text-align:left;width:13.6cm; " class="Table1_B2"><p class="P11">Will hold the last SHA that was posted by the bot (so it doesn’t post things it has already posted) on first run it will psot the last 14 messages. If you don’t want it to post on first run, place in this file the the full SHA code of the latest commmit eg “<span class="T3">d3bc6f0290f88afc8b18bdf3628fca04010fa6b6”</span><span class="T4"> code with no spaces or new lines.</span></p></td></tr></table><p class="P5"> </p><h1 class="Heading_20_1"><a id="a__Making_changes"><span/></a><a id="__RefHeading___Toc360_1493417463"/>Making changes</h1><p class="P5">What you need to change to get it working for you.</p><p class="P6">The following variables will be changed to your specified things</p><p class="P6"> </p><p class="P6">DISCORD_URL = "<a href="https://discordapp.com/api/webhooks/%5Bnumber%5D/%5Bbodyoftext" class="Internet_20_link">https://discordapp.com/api/webhooks/[number]/[bodyoftext</a>]”</p><p class="P6">This is the webhook obtained from discord itself, <br/>For more info: <a href="https://support.discordapp.com/hc/en-us/articles/228383668-Intro-to-Webhooks" class="Internet_20_link">https://support.discordapp.com/hc/en-us/articles/228383668-Intro-to-Webhooks</a></p><p class="P6"> </p><p class="P6">BIT_BUCKET_URL = "https://api.bitbucket.org/1.0/repositories/[user]/[repository]/changesets"</p><p class="P6">This you will need to build, see below for details</p><p class="Text_20_body"/><p class="P6">bit_bucket_username = "user"<br/>The username you will be accessing bitbucket with, I advise a new account because the password is kept in plain text</p><p class="P6"> </p><p class="P6">bit_bucket_password = "Password"<br/>The password in plain text, used for accessing the repositories changes</p><h1 class="Heading_20_1"><a id="a__How_to_construct_bitbucket_url"><span/></a><a id="__RefHeading___Toc135_1748241689"/>How to construct bitbucket url</h1><p class="Text_20_body"> </p><p class="P6">Navigate to the repository, you will see the following <br/></p><p class="P6">"<a href="https://bitbucket.org/%5BUser" class="Internet_20_link">https://bitbucket.org/[User</a> Who created it]/[Repository name]/overview”</p><p class="P6">Put the two variables into the link below</p><p class="P6">"https://api.bitbucket.org/1.0/repositories/<a href="https://bitbucket.org/%5BUser" class="Internet_20_link">[User</a> Who created it]/[Repository name]/changesets"</p><p class="P6">(square backets not needed unless in the initial link)</p><p class="P6">Done, this can now be placed in the script</p><h1 class="Heading_20_1"><a id="a__User_name_and_paswords"><span/></a><a id="__RefHeading___Toc137_1748241689"/>User name and paswords</h1><p class="P6">I advise using a separate account that only has read permissions (it would be nice if it only had access to the commit messages, but thats beyond me)</p><p class="Text_20_body"> </p><h1 class="Heading_20_1"><a id="a__Changes_that_the_script_makes_to_the_url"><span/></a><a id="__RefHeading___Toc141_1748241689"/>Changes that the script makes to the url</h1><p class="Text_20_body"> </p><p class="P6">This script adds the ‘/slack’ to the end of the link provided, this allows the json to be parsed properly by discord. </p><h1 class="Heading_20_1"><a id="a__JSON_sample"><span/></a><a id="__RefHeading___Toc143_1748241689"/>JSON sample</h1><p class="P6">{</p><p class="P6">"username": "Clyde",</p><p class="P6">"text": "I am Clyde, this is an example webhook message.",</p><p class="P6">"icon_url": "https://discordapp.com/assets/f78426a064bc9dd24847519259bc42af.png",</p><p class="P6">"attachments": [{</p><p class="P6">"author_name": "Clyde",</p><p class="P6">"author_icon": "https://discordapp.com/assets/f78426a064bc9dd24847519259bc42af.png",</p><p class="P6">"color": "#ff0000",</p><p class="P6">"title": "Clyde's Embed",</p><p class="P6">"text": "This is text. This text is in Clyde's embed.",</p><p class="P6">"fields": [{</p><p class="P6">"title": "Clyde's Embed's Field",</p><p class="P6">"value": "Clyde's Embed's Field's Value."</p><p class="P6">}],</p><p class="P6">"footer_icon": "https://discordapp.com/assets/f78426a064bc9dd24847519259bc42af.png",</p><p class="P6">"footer": "Clyde's Embed's Footer"</p><p class="P6">}]</p><p class="P6">}</p><p class="P6"> </p><p class="P6">source: <a href="https://www.reddit.com/r/discordapp/comments/56ktov/discord_webhook_message_maker_json/" class="Internet_20_link">https://www.reddit.com/r/discordapp/comments/56ktov/discord_webhook_message_maker_json/</a></p><p class="P7">This is also kept in a txt file</p><p class="P6">Special thanks to source above for this super simple json <span class="T2">construction, try just sending that to your server</span> <span class="T2">and play around with it to understand what it does.<br/><br/>In disPost.py- replace message with this json, set the discord url and call sendMessage to test what changes do what.</span></p><p class="P6"> </p><p class="P6"> </p><p class="Text_20_body"> </p><h1 class="Heading_20_1"><a id="a__Notes_on_getting_more_commit_messages"><span/></a><a id="__RefHeading___Toc362_1493417463"/>Notes on getting more commit messages</h1><p class="Text_20_body"> </p><h4 class="Heading_20_4"><a id="a__My_issues_with_cron"><span/></a><a id="__RefHeading___Toc364_1493417463"/>My issues with cron</h4><p class="P9">Running the script by manually works fine, but when trying to add it to cron, the lastNode file can’t be found unless I specify its location by absolute instead of relative. </p><p class="P9">But thats just cos I don’t know how cron works</p><p class="P8"> </p><h4 class="Heading_20_4"><a id="a__Bit_Bucket_things"><span/></a><a id="__RefHeading___Toc366_1493417463"/>Bit Bucket things</h4><p class="P8">By default the bitbucket api sends the last 14 commit messages, this amount can be changed by adding to the url ?limit=[integer]</p><p class="P8">For more information see :</p><p class="P8"> <a href="https://confluence.atlassian.com/bitbucket/changesets-resource-296095208.html" class="Internet_20_link">https://confluence.atlassian.com/bitbucket/changesets-resource-296095208.html</a></p><p class="P8">(scroll down to see Get a list of changesets)</p><p class="P8"> </p><h4 class="Heading_20_4"><a id="a__Thanks"><span/></a><a id="__RefHeading___Toc368_1493417463"/>Thanks</h4><p class="P8">Thanks to everyone online for setting up this standard and making it really easy for me to build this. From not knowing anything about requests managed to build this.<br/>Any questions feel free to contact me through github (idk make an issue or something, tag me maybe I have an email floating around there)</p></body></html>